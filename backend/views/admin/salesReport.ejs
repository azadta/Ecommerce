<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>eCommerce Admin Panel</title>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet">
    <link href="/adminPanel.css" rel="stylesheet">
    <!-- Favicon -->
    <link href="/img/favicon.ico" rel="icon">

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css?family=Open+Sans:400,600,700&display=swap" rel="stylesheet">

    <!-- CSS Libraries -->
    <link href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <link href="/lib/slick/slick.css" rel="stylesheet">
    <link href="/lib/slick/slick-theme.css" rel="stylesheet">

    <!-- Template Stylesheet -->
    <link href="/css/style.css" rel="stylesheet">
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 20px;
        }
      
        .alerts {
            max-width: 600px;
            margin: 20px auto;
            padding: 0;
            list-style: none;
        }
        .alert {
            background-color: #ffdddd;
            border-left: 6px solid #f44336;
            margin-bottom: 15px;
            padding: 15px;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .alert p {
            margin: 0;
            color: #a94442;
        }
        .alert button {
            background-color: #f44336;
            color: white;
            border: none;
            padding: 10px 20px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 14px;
            margin: 0;
            cursor: pointer;
            border-radius: 5px;
        }
        .alert button:hover {
            background-color: #d32f2f;
        }




        body {
            font-family: Arial, sans-serif;
            background-color: #f7f7f7;
            margin: 0;
            padding: 0;
        }
      
        h1 {
            text-align: center;
            margin-bottom: 20px;
            color: #333;
        }
        .filter-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .filter-section select, 
        .filter-section input[type="date"] {
            padding: 8px;
            font-size: 16px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .filter-section button {
            padding: 10px 20px;
            font-size: 16px;
            background-color: #28a745;
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .filter-section button:hover {
            background-color: #218838;
        }
        .summary {
            display: flex;
            justify-content: space-between;
            margin-bottom: 20px;
        }
        .summary .box {
            flex: 1;
            padding: 20px;
            margin: 10px;
            background-color: #007bff;
            color: #fff;
            text-align: center;
            border-radius: 4px;
        }
        .summary .box h3 {
            margin: 0 0 10px 0;
            font-size: 24px;
        }
        .summary .box p {
            font-size: 18px;
            margin: 0;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        table th, table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        table th {
            background-color: #007bff;
            color: #fff;
        }
        table tbody  {
            background-color: #f1f1f1;
            color: black;
        }
        .total-row td {
            font-weight: bold;
        }
        h3{

     color: black;

        }
        .pagination {
    display: flex;
    justify-content: center;
    align-items: center;
    margin-top: 20px;
    font-family: Arial, sans-serif;
}

.pagination a {
    color: #007bff;
    padding: 10px 15px;
    margin: 0 5px;
    text-decoration: none;
    border: 1px solid #dee2e6;
    border-radius: 4px;
    background-color: #f8f9fa;
    transition: background-color 0.3s, color 0.3s;
}

.pagination a:hover {
    background-color: #ffd500;
    color: #fff;
}

.pagination a.active-page {
    background-color: #007bff;
    color: #fff;
    font-weight: bold;
    border-color: #0056b3;
    box-shadow: 0 0 10px rgba(0, 123, 255, 0.5);
    transform: scale(1.1);
    pointer-events: none; /* Makes the link non-clickable */
}

.pagination a.page-link {
    color: #007bff;
}

.pagination a.prev-next {
    background-color: #343a40;
    color: #fff;
}

.pagination a.prev-next:hover {
    background-color: #495057;
}
#custom-date-range {
    margin-top: 10px;
}

#filter {
    margin-bottom: 10px;
}

    </style>
</head>
<body>
       <!-- Top Header Start -->
       <div class="top-header">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-md-3">
                    <div class="logo">
                        <a href="">
                            <img src="/img/logo.png" alt="Logo">
                        </a>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="search">
                        <input type="text" placeholder="Search">
                        <button><i class="fa fa-search"></i></button>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="user">
                        <div class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">My Account</a>
                            <div class="dropdown-menu">
                                <a href="/me" class="dropdown-item">Profile</a>
                                <a href="/logout" class="dropdown-item">Logout</a>
                            </div>
                        </div>
                        <div class="cart">
                            <i class="fa fa-cart-plus"></i>
                            <span>(0)</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Top Header End -->
      <!-- Header Start -->
      <div class="header">
        <div class="container">
            <nav class="navbar navbar-expand-md bg-dark navbar-dark">
                <a href="/" class="navbar-brand">MENU</a>
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbarCollapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <div class="collapse navbar-collapse justify-content-between" id="navbarCollapse">
                    <div class="navbar-nav m-auto">
                        <a href="/" class="nav-item nav-link active">Home</a>
                        <a href="product-list.html" class="nav-item nav-link">Products</a>
                        <div class="nav-item dropdown">
                            <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Pages</a>
                            <div class="dropdown-menu">
                                <a href="product-list.html" class="dropdown-item">Product</a>
                                <a href="product-detail.html" class="dropdown-item">Product Detail</a>
                                <a href="cart.html" class="dropdown-item">Cart</a>
                                <a href="wishlist.html" class="dropdown-item">Wishlist</a>
                                <a href="checkout.html" class="dropdown-item">Checkout</a>
                                <a href="/register" class="dropdown-item">Login & Register</a>
                                <a href="my-account.html" class="dropdown-item">My Account</a>
                            </div>
                        </div>
                        <a href="contact.html" class="nav-item nav-link">Contact Us</a>
                    </div>
                </div>
            </nav>
        </div>
    </div>
    <!-- Header End -->
    
    
    <div class="d-flex" id="wrapper">
        <!-- Sidebar -->
        <div class="bg-light border-right" id="sidebar-wrapper">
  
            <div class="list-group list-group-flush">
                <a href="#" class="list-group-item list-group-item-action bg-light">Dashboard</a>
                <a href="/listAllProducts" class="list-group-item list-group-item-action bg-light">Products</a>
                <a href="/getAllOrders" class="list-group-item list-group-item-action bg-light">Orders</a>
                <a href="/getAllUsers" class="list-group-item list-group-item-action bg-light">Users</a>
                <a href="/getAllCategories" class="list-group-item list-group-item-action bg-light">Categories</a>
                <a href="/offers" class="list-group-item list-group-item-action bg-light">Offers</a>
                <a href="/allcoupons" class="list-group-item list-group-item-action bg-light">Coupons</a>
          
            </div>
        </div>
       

            <div class="container-fluid">
                <h1 class="mt-4">Admin Dashboard</h1>
                

                <div id="page-content-wrapper">
                    <div class="container-fluid">
                        <h1>Sales Report</h1>
                        <%if(typeof message!=='undefined'&&message){%>
                            <h5 style="color: blue;"><%= message %></h5>
                            <% } %>

<!-- Filter Section -->
<div class="filter-section">
    <div style="display: flex; flex-direction: column;">
        <label for="filter">Filter By:</label>
        <select id="filter" name="filter" onchange="toggleCustomDate(this.value)">
            <option value="day">1 Day</option>
            <option value="week">1 Week</option>
            <option value="month">1 Month</option>
            <option value="year">1 Year</option>
            <option value="custom">Custom Date</option>
        </select>
        <button onclick="filterSales()" style="margin-top: 10px; padding: 5px 10px; font-size: 14px;">Filter</button>
        
    </div>
    <div id="custom-date-range" style="display: none;">
        <input type="date" id="startDate" name="startDate">
        <input type="date" id="endDate" name="endDate">
    </div>
</div>




                    
                        <!-- Summary Section -->
                        <div class="summary">
                            <div class="box">
                                <h3>Total Sales Counts</h3>
                                <p><%= salesCount %></p>
                            </div>
                            <div class="box">
                                <h3>Total Sales Amount</h3>
                                <p>Rs <%= totalOrderAmount.toFixed(2) %></p>
                            </div>
                            <div class="box">
                                <h3>Total Order Amount</h3>
                                <p>Rs <%= (parseFloat(allOrdersTotalAmount)).toFixed(2) %></p>
                            </div>
                            <div class="box">
                                <h3>Total Discounts</h3>
                                <p>Rs <%= (parseFloat(totalDiscount)).toFixed(2) %></p>
                            </div>
                            <div class="box">
                                <h3>Coupon Deductions</h3>
                                <p>Rs <%= totalCouponDiscount.toFixed(2) %></p>
                            </div>
                        </div>
                    
                        <!-- Sales Table -->
<table style="width: 100%; border-collapse: collapse;">
    <thead>
        <tr style="text-align: left;">
            <th style="padding: 8px; border-bottom: 2px solid #ddd;">Order ID</th>
            <th style="padding: 8px; border-bottom: 2px solid #ddd;">Order Date</th>
            <th style="padding: 8px; border-bottom: 2px solid #ddd;">Products</th>
            <th style="padding: 8px; border-bottom: 2px solid #ddd;">Quantity</th>
            <th style="padding: 8px; border-bottom: 2px solid #ddd;">Original Price</th>
            <th style="padding: 8px; border-bottom: 2px solid #ddd;">Discounted Price</th>
            <th style="padding: 8px; border-bottom: 2px solid #ddd;">Coupon Discount</th>
            <th style="padding: 8px; border-bottom: 2px solid #ddd;">Final Amount</th>
        </tr>
    </thead>
    <tbody>
        <% orders.forEach(order => { %>
            <tr style="border-bottom: 1px solid #ddd;">
                <td style="padding: 8px;">
                    <%= order._id %>
                </td>
                <td style="padding: 8px;"><%= new Date(order.createdAt).toLocaleDateString() %></td>
                <td style="padding: 8px;">
                    <ul style="list-style-type: none; padding-left: 0;">
                        <% order.orderItems.forEach(item => { %>
                            <li><%= item.product.name %></li>
                        <% }) %>
                    </ul>
                </td>
                <td style="padding: 8px;">
                    <ul style="list-style-type: none; padding-left: 0;">
                        <% order.orderItems.forEach(item => { %>
                            <li><%= item.quantity %></li>
                        <% }) %>
                    </ul>
                </td>
                <td style="padding: 8px;">
                    <ul style="list-style-type: none; padding-left: 0;">
                        <% order.orderItems.forEach(item => { %>
                            <li>Rs <%= (item.product.price).toFixed(2) %></li>
                        <% }) %>
                    </ul>
                </td>
                <td style="padding: 8px;">
                    <ul style="list-style-type: none; padding-left: 0;">
                        <% order.orderItems.forEach(item => { %>
                            <li>Rs <%= (item.price).toFixed(2) %></li>
                        <% }) %>
                    </ul>
                </td>
                <td style="padding: 8px;"><%= order.couponDiscount ? 'Rs ' + order.couponDiscount.toFixed(2) : 'N/A' %></td>
                <td style="padding: 8px;">Rs <%= order.totalPrice.toFixed(2) %></td>
            </tr>
        <% }) %>
    </tbody>
</table>

                
                   
                          
                       
                    </div>
                </div>

               

               
                
            </div>
        </div>
        <!-- /#page-content-wrapper -->
<!-- Stylish Pagination Links -->
<div class="pagination">
    <% if (currentPage > 1) { %>
        <a href="?period=<%= period %>&startDate=<%= startDate %>&endDate=<%= endDate %>&page=<%= currentPage - 1 %>" class="prev-next">Previous</a>
    <% } %>

    <% for (let i = 1; i <= totalPages; i++) { %>
        <a href="?period=<%= period %>&startDate=<%= startDate %>&endDate=<%= endDate %>&page=<%= i %>"
           class="<%= i === currentPage ? 'active-page' : 'page-link' %>"><%= i %></a>
    <% } %>

    <% if (currentPage < totalPages) { %>
        <a href="?period=<%= period %>&startDate=<%= startDate %>&endDate=<%= endDate %>&page=<%= currentPage + 1 %>" class="prev-next">Next</a>
    <% } %>
</div>



    </div>
    
 <!-- Form for downloading the sales report -->
<form action="/admin/downloadSalesReport" method="get">
    <!-- Existing filters -->
    <input type="hidden" name="period" value="<%= period %>">
    <input type="hidden" name="startDate" value="<%= startDate %>">
    <input type="hidden" name="endDate" value="<%= endDate %>">
    
    <!-- Format selection -->
    <label for="format">Select Report Format:</label>
    <select name="format" id="format">
        <option value="excel">Excel</option>
        <option value="pdf">PDF</option>
    </select>
    
    <!-- Submit button -->
    <button type="submit">Download Report</button>
</form>

    
    

    <!-- Bootstrap core JavaScript -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script src="/adminPanel.js"></script>
    
    <br>
    <br>
     <!-- Footer Start -->
     <div class="footer">
        <div class="container-fluid">
            <div class="row">
                <div class="col-lg-3 col-md-6">
                    <div class="footer-widget">
                        <h1>E Shop</h1>
                        <p>
                            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Suspendisse sollicitudin rutrum massa. Suspendisse sollicitudin rutrum massa. Vestibulum porttitor, metus sed pretium elementum, nisi nibh sodales quam, non lobortis neque felis id mauris.
                        </p>
                    </div>
                </div>

                <div class="col-lg-3 col-md-6">
                    <div class="footer-widget">
                        <h3 class="title">Useful Pages</h3>
                        <ul>
                            <li><a href="product.html">Product</a></li>
                            <li><a href="product-detail.html">Product Detail</a></li>
                            <li><a href="cart.html">Cart</a></li>
                            <li><a href="checkout.html">Checkout</a></li>
                            <li><a href="login.html">Login & Register</a></li>
                            <li><a href="my-account.html">My Account</a></li>
                        </ul>
                    </div>
                </div>

                <div class="col-lg-3 col-md-6">
                    <div class="footer-widget">
                        <h3 class="title">Quick Links</h3>
                        <ul>
                            <li><a href="product.html">Product</a></li>
                            <li><a href="cart.html">Cart</a></li>
                            <li><a href="checkout.html">Checkout</a></li>
                            <li><a href="login.html">Login & Register</a></li>
                            <li><a href="my-account.html">My Account</a></li>
                            <li><a href="wishlist.html">Wishlist</a></li>
                        </ul>
                    </div>
                </div>

                <div class="col-lg-3 col-md-6">
                    <div class="footer-widget">
                        <h3 class="title">Get in Touch</h3>
                        <div class="contact-info">
                            <p><i class="fa fa-map-marker"></i>123 E Shop, Los Angeles, CA, USA</p>
                            <p><i class="fa fa-envelope"></i>email@example.com</p>
                            <p><i class="fa fa-phone"></i>+123-456-7890</p>
                            <div class="social">
                                <a href=""><i class="fa fa-twitter"></i></a>
                                <a href=""><i class="fa fa-facebook"></i></a>
                                <a href=""><i class="fa fa-linkedin"></i></a>
                                <a href=""><i class="fa fa-instagram"></i></a>
                                <a href=""><i class="fa fa-youtube"></i></a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="row payment">
                <div class="col-md-6">
                    <div class="payment-method">
                        <p>We Accept:</p>
                        <img src="/img/payment-method.png" alt="Payment Method" />
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="payment-security">
                        <p>Secured By:</p>
                        <img src="/img/godaddy.svg" alt="Payment Security" />
                        <img src="/img/norton.svg" alt="Payment Security" />
                        <img src="/img/ssl.svg" alt="Payment Security" />
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- Footer End -->

    
    <!-- Footer Bottom Start -->
    <div class="footer-bottom">
        <div class="container">
            <div class="row">
                <div class="col-md-6 copyright">
                    <p>Copyright &copy; <a href="https://htmlcodex.com">HTML Codex</a>. All Rights Reserved</p>
                </div>

                <div class="col-md-6 template-by">
                    <p>Template By <a href="https://htmlcodex.com">HTML Codex</a></p>
                </div>
            </div>
        </div>
    </div>
    <!-- Footer Bottom End -->
    
    
    <!-- Back to Top -->
    <a href="#" class="back-to-top"><i class="fa fa-chevron-up"></i></a>

    
    <!-- JavaScript Libraries -->
    <script src="https://code.jquery.com/jquery-3.4.1.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.bundle.min.js"></script>
    <script src="/lib/easing/easing.min.js"></script>
    <script src="/lib/slick/slick.min.js"></script>

    
    <!-- Template Javascript -->
    <script src="/js/main.js"></script>

    <!-- // Function to toggle custom date input visibility -->
    <script>
function toggleCustomDate(value) {
    const customDateRange = document.getElementById('custom-date-range');
    customDateRange.style.display = value === 'custom' ? 'block' : 'none';
}

// Function to filter sales (for salesReport controller)
function filterSales() {
    const filter = document.getElementById('filter').value;
    const startDate = document.getElementById('startDate').value;
    const endDate = document.getElementById('endDate').value;

    let query = `?period=${filter}`;

    if (filter === 'custom') {
        // Validate custom dates
        if (!startDate || !endDate) {
            alert('Please select both start and end dates for the custom period.');
            return;
        }
        if (new Date(startDate) > new Date(endDate)) {
            alert('Start date cannot be later than end date.');
            return;
        }
        query += `&startDate=${startDate}&endDate=${endDate}`;
    }

    // Redirect to the salesReport controller with the query parameters
    window.location.href = `/admin/salesReport${query}`;
}

// Function to download sales report (for downLoadSalesReport controller)
function downloadSalesReport() {
    const filter = document.getElementById('filter').value;
    const startDate = document.getElementById('startDate').value;
    const endDate = document.getElementById('endDate').value;

    let query = `?period=${filter}`;

    if (filter === 'custom') {
        // Validate custom dates
        if (!startDate || !endDate) {
            alert('Please select both start and end dates for the custom period.');
            return;
        }
        if (new Date(startDate) > new Date(endDate)) {
            alert('Start date cannot be later than end date.');
            return;
        }
        query += `&startDate=${startDate}&endDate=${endDate}`;
    }

    // Redirect to the downLoadSalesReport controller with the query parameters
    window.location.href = `/downLoadSalesReport${query}`;
}

// Initialize the filter and custom dates based on query parameters
function initializeFilter() {
    const queryParams = new URLSearchParams(window.location.search);
    const filterSelect = document.getElementById('filter');
    const selectedValue = queryParams.get('period') || 'day'; // Default to 'day' if no value is set
    const startDate = queryParams.get('startDate') || '';
    const endDate = queryParams.get('endDate') || '';

    // Set the select element to the saved value
    filterSelect.value = selectedValue;

    if (selectedValue === 'custom') {
        document.getElementById('startDate').value = startDate;
        document.getElementById('endDate').value = endDate;
        document.getElementById('custom-date-range').style.display = 'block';
    }
}

// Call initializeFilter when the page loads
document.addEventListener('DOMContentLoaded', initializeFilter);
</script>
<script>
    // JavaScript to show/hide custom date range inputs based on the selected period
    document.getElementById('period').addEventListener('change', function() {
        var customDateRange = document.getElementById('customDateRange');
        if (this.value === 'custom') {
            customDateRange.style.display = 'block';
        } else {
            customDateRange.style.display = 'none';
        }
    });
</script>

   
</body>
</html>
